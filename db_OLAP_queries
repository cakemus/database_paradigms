/* To generate the first table, showing how many lesson, both type and total there were every month during the year */
SELECT 
  EXTRACT(YEAR FROM date) AS year,
  EXTRACT(MONTH FROM date) AS month,
  COUNT(*) AS total_lessons,
  COUNT(CASE WHEN pricing_id BETWEEN 1 AND 3 THEN 1 END) AS individual_lessons,
  COUNT(CASE WHEN pricing_id BETWEEN 4 AND 6 THEN 1 END) AS group_lessons,
  COUNT(CASE WHEN pricing_id BETWEEN 7 AND 9 THEN 1 END) AS ensemble_lessons
FROM 
  public.lesson
WHERE 
  EXTRACT(YEAR FROM date) = '2023'
GROUP BY 
  year, month
ORDER BY 
  year, month;

/* Generates table with sibling count of all students */

WITH SiblingCounts AS (
    SELECT 
        s.student_id, 
        COUNT(sr.sibling_id) AS sibling_count
    FROM 
        public.student s
        LEFT JOIN public.sibling_ref sr ON s.student_id = sr.student_id
    GROUP BY 
        s.student_id
)
SELECT 
    sibling_count, 
    COUNT(student_id) AS number_of_students
FROM 
    SiblingCounts
GROUP BY 
    sibling_count
ORDER BY 
    sibling_count;

